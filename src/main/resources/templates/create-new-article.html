<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <div th:replace="blocks/head :: head"></div>
    <title>Blog</title>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>

<body>
<div th:insert="blocks/header :: header" th:remove="tag"></div>

<div class="container h-100 mt-4">
    <form action="/articles/create-new-article" method="POST" enctype="multipart/form-data">
        <input id="title" name="title" type="text" class="form-control mb-2" placeholder="Title">
        <input id="image" name="image" class="form-control mb-4" type="file" accept="image/*">
        <textarea id="text" name="text"></textarea>
        <div dir="rtl">
            <button class="btn btn-primary btn-lg mt-1" type="submit">Submit</button>
        </div>
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
    </form>
</div>

<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
<script>
        tinymce.init({
            selector: "textarea#text",
            menubar: false,
            statusbar: false,
            images_upload_handler: function (blobInfo, success, failure) {
                var xhr, formData;

                xhr = new XMLHttpRequest();
                xhr.withCredentials = false;
                xhr.open('POST', 'http://localhost:8080/articles/upload-image');

                formData = new FormData();
                formData.append('file', blobInfo.blob(), blobInfo.filename());

                var token = $("meta[name='_csrf']").attr("content");
                var header = $("meta[name='_csrf_header']").attr("content");
                xhr.setRequestHeader(header, token);
                xhr.send(formData);
            }
        });

</script>

<div th:insert="blocks/footer :: footer"></div>
</body>

</html>